name: aws oidc auth
description: |
  Get aws oidc auth.
inputs:
  role-to-assume1:
    description: "AWS IAM Role to assume 1"
    required: true
  role-to-assume2:
    description: "AWS IAM Role to assume 2"
    required: true
runs:
  using: "composite" # this is key point
  steps:
    - name: Configure AWS Credentials
      # must use "master", not "v1". v1 is not yet released to use latest role-to-assume.
      # Error: Credentials could not be loaded, please check your action inputs: Could not load credentials from any providers
      uses: aws-actions/configure-aws-credentials@master
      with:
        aws-region: ap-northeast-1
        role-to-assume: ${{ inputs.role-to-assume1 }}
        role-session-name: GitHubActions-${{ github.run_id }}
        role-duration-seconds: 900 # minimum: 900sec, maximum: iam role session duration
    - name: get-caller-identity is allowed to run on role.
      run: aws sts get-caller-identity
      shell: bash
    - name: Configure AWS Credentials
      # must use "master", not "v1". v1 is not yet released to use latest role-to-assume.
      # Error: Credentials could not be loaded, please check your action inputs: Could not load credentials from any providers
      uses: aws-actions/configure-aws-credentials@master
      with:
        aws-region: ap-northeast-1
        role-to-assume: ${{ inputs.role-to-assume2 }}
        role-session-name: GitHubActions-${{ github.run_id }}
        role-duration-seconds: 900 # minimum: 900sec, maximum: iam role session duration
    - name: get-caller-identity is allowed to run on role.
      run: aws sts get-caller-identity
      shell: bash
